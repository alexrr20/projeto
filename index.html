<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TEST TEST TEST</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
  </head>
  <body class="light">
    <header>
      <div id="logoContainer">
        <img src="logo.svg" alt="logo" id="logo">
      </div>
      <nav>
        <ul id="navList">
          <li><a href="#">Página Inicial</a></li>
          <li><a href="#">Pontos de Testagem</a></li>
          <li><a href="#">Info</a></li>
          <li><a href="#">Agendar Teste</a></li>
          <li><a href="#"></a></li>
          <li><button type="submit" class="btnSubmit">LOGIN</button></li>
        </ul>
      </nav>
    </header>
    <main>
      <input type="text" class="inpUser"></input>
      <button type="submit" class="btnSubmit">Add Account</button>
      <button type="submit" class="btnSubmit">Add All Accounts</button>
      <button type="reset" class="btnRemove">Remove Account</button>
      <button type="reset" class="btnRemove">Remove All Accounts</button>
      <a id="btnLight" href="#">Light Theme</a>
      <a id="btnDark" href="#">Dark Theme</a>
    </main>
    <script>
      let btnSubmit = document.querySelectorAll(".btnSubmit");
      let btnRemove = document.querySelectorAll(".btnRemove");
      let btnLight = document.querySelectorAll("#btnLight")
      let btnDark = document.querySelectorAll("#btnDark")
      let imgLogo = document.querySelectorAll("#logo")
      let body = document.body;


      btnDark[0].addEventListener("click",()=>{
        body.classList.replace("light","dark")
        imgLogo[0].src="logo2.svg"
      })

      btnLight[0].addEventListener("click",()=>{
        body.classList.replace("dark","light")
        imgLogo[0].src="logo.svg"
      })

      class User{
        constructor(username){
          this.username = username;
        }
         
        hello = function(){
          console.log("Hello")
        }
      }

      btnSubmit[0].addEventListener("click", function () {
        let lsUser = JSON.parse(localStorage.getItem("User"));
        let inpUser = document.querySelectorAll(".inpUser")
        let userAdd = inpUser[0].value
        let newUser = new User(userAdd)

        console.log(newUser)
        
        if (!lsUser){
          let arrayAdd = [newUser]
          console.log(arrayAdd)
          localStorage.setItem("User", JSON.stringify(arrayAdd))
        } else {
          lsUser.push(newUser)
          console.log(JSON.stringify(lsUser))
          localStorage.setItem("User", JSON.stringify(lsUser))
        }
      })

      btnRemove[0].addEventListener("click", function () {
        let lsUser = JSON.parse(localStorage.getItem("User"));
        
        if (!(lsUser)){
          alert("Esta conta não existe! Tente de novo")
            return
        }

        let inpUser = document.querySelectorAll(".inpUser");
        let userRemove = inpUser[0].value;
        let indexRemove = function() {
          for(let i =0;i<lsUser.length;i++){
            if(lsUser[i].username == userRemove){
              return i;
            }
          }
          return -1;
        }

        lsUser.splice(indexRemove, 1);
        if (!(userRemove.length) || indexRemove == -1){
            alert("Esta conta não existe! Tente de novo")
            return
        } else if (!(lsUser.length)){
            localStorage.removeItem("User")
        } else {
            localStorage.setItem("User", JSON.stringify(lsUser))
        }
      });

      btnRemove[1].addEventListener("click", function () {
        localStorage.removeItem("User");
      });

      btnSubmit[2].addEventListener("click", function(){
        if(!(localStorage.getItem("Logged In"))){
          let lsUser = JSON.parse(localStorage.getItem("User"))
          let inpUser = document.querySelectorAll(".inpUser")
          let userLogin = inpUser[0].value

          for(let i = 0; i<lsUser.length;i++){
            if(lsUser[i].username == userLogin){
              localStorage.setItem("Logged In",JSON.stringify(lsUser[i]))
            }
          }
          btnSubmit[2].textContent = "LOGOUT"
        } else {
          localStorage.removeItem("Logged In")
          btnSubmit[2].textContent = "LOGIN"
        }

      })
      
    </script>
  </body>
</html>
